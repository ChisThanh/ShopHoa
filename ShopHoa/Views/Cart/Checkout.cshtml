@{
ViewBag.Title = "Checkout";
Layout = "~/Views/Shared/Master.cshtml";
}

<!-- Khu vực Breadcrumb bắt đầu ở đây -->
<div class="breadcrumbs-area position-relative">

    <div class="container">
        <div class="row">
            <div class="col-12 text-center">
                <div class="breadcrumb-content position-relative section-content">
                    <h3 class="title-3">Thủ Tục Thanh Toán</h3>
                    <ul>
                        <li><a href="index.html">Trang Chủ</a></li>
                        <li>Thủ Tục Thanh Toán</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Khu vực Breadcrumb kết thúc ở đây -->
<!-- Khu vực thanh toán bắt đầu tại đây -->
<div class="checkout-area mt-no-text">
    <div class="container custom-container">
        <div class="row">
            <div class="col-12 col-custom">
                <div class="coupon-accordion">
                    <h3>Có phiếu giảm giá? <span id="showcoupon">Bấm vào đây để nhập mã của bạn</span></h3>
                    <div id="checkout_coupon" class="coupon-checkout-content">
                        <div class="coupon-info">
                            <form action="#">
                                <p class="checkout-coupon">
                                    <input placeholder="Coupon code" type="text">
                                    <input class="coupon-inner_btn" value="Apply Coupon" type="submit">
                                </p>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6 col-12 col-custom">
                <form action="#" id="form">
                    <div class="checkbox-form">
                        <h3>Chi tiết thanh toán</h3>
                        <div class="row">

                            <div class="col-md-12 col-custom">
                                <div class="checkout-form-list">
                                    <label>Họ và tên<span class="required">*</span></label>
                                    <input placeholder="" type="text" name="name">
                                </div>
                            </div>

                            <div class="col-md-12 col-custom">
                                <div class="checkout-form-list">
                                    <label>Địa chỉ <span class="required">*</span></label>
                                    <input placeholder="Địa chỉ đường phố" type="text" name="address">
                                </div>
                            </div>

                            <div class="col-md-12 col-custom">
                                <div class="checkout-form-list">
                                    <label>Tỉnh / Thành phố <span class="required">*</span></label>
                                    <input type="text" name="city">
                                </div>
                            </div>
                            <div class="col-md-6 col-custom">
                                <div class="checkout-form-list">
                                    <label>Quận / Huyện <span class="required">*</span></label>
                                    <input placeholder="" type="text" name="district">
                                </div>
                            </div>
                            <div class="col-md-6 col-custom">
                                <div class="checkout-form-list">
                                    <label>Phường / Xã <span class="required">*</span></label>
                                    <input placeholder="" type="text" name="ward">
                                </div>
                            </div>
                            <div class="col-md-12 col-custom">
                                <div class="checkout-form-list">
                                    <label>Điện thoại <span class="required">*</span></label>
                                    <input type="text" name="phonenumber">
                                </div>
                            </div>

                        </div>
                        <div class="different-address">
                            <div class="order-notes mt-3">
                                <div class="checkout-form-list checkout-form-list-2">
                                    <label>Ghi chú đặt hàng</label>
                                    <textarea name="note" id="checkout-mess" cols="30" rows="10"
                                        placeholder="Ghi chú về đơn đặt hàng của bạn, ví dụ: ghi chú đặc biệt để giao hàng."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-lg-6 col-12 col-custom">
                <div class="your-order">
                    <h3>Đơn hàng của bạn</h3>
                    <div class="your-order-table table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th class="cart-product-name">Sản phẩm</th>
                                    <th class="cart-product-total">Tổng cộng</th>
                                </tr>
                            </thead>
                            <tbody id="tblCartCheckout">

                            </tbody>
                            <tfoot>
                                <tr class="cart-subtotal">
                                    <th>VAT</th>
                                    <td class="text-center"><span class="amount">10.000 VND</span></td>
                                </tr>
                                <tr class="order-total">
                                    <th>Tổng tiền thanh toán</th>
                                    <td class="text-center"><strong><span class="amount" id="totalC">0</span></strong>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div class="payment-method">
                        <div class="payment-accordion">
                            <div id="accordion">
                                <div class="card">
                                    <div class="card-header" id="#payment-1">
                                        <h5 class="panel-title mb-3">
                                            <a href="#" class="" data-bs-toggle="collapse" data-bs-target="#collapseOne"
                                                aria-expanded="true" aria-controls="collapseOne">
                                                Chuyển khoản trực tiếp.
                                            </a>
                                        </h5>
                                    </div>
                                    <div id="collapseOne" class="collapse show" data-parent="#accordion">
                                        <div class="card-body mb-2 mt-2">
                                            <p>Thực hiện thanh toán trực tiếp vào tài khoản ngân hàng của chúng tôi. Vui
                                                lòng sử dụng ID đơn hàng của bạn làm tài liệu tham khảo thanh toán. Đơn
                                                đặt hàng của bạn sẽ không được giao cho đến khi tiền đã được xóa trong
                                                tài khoản của chúng tôi.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-header" id="#payment-2">
                                        <h5 class="panel-title mb-3">
                                            <a href="#" class="collapsed" data-bs-toggle="collapse"
                                                data-bs-target="#collapseTwo" aria-expanded="false"
                                                aria-controls="collapseTwo">
                                                Thanh toán qua thẻ
                                            </a>
                                        </h5>
                                    </div>
                                    <div id="collapseTwo" class="collapse" data-parent="#accordion">
                                        <div class="card-body mb-2 mt-2">
                                            <p>Thực hiện thanh toán trực tiếp vào tài khoản ngân hàng của chúng tôi. Vui
                                                lòng sử dụng ID đơn hàng của bạn làm tài liệu tham khảo thanh toán. Đơn
                                                đặt hàng của bạn sẽ không được giao cho đến khi tiền đã được xóa trong
                                                tài khoản của chúng tôi.</p>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="order-button-payment">
                                <button class="btn flosun-button secondary-btn black-color rounded-0 w-100"
                                    id="order">Đặt
                                    hàng</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Khu vực thanh toán kết thúc tại đây -->
@section js{
<script>
    if (cart.getList().length === 0) {
        $("#tblCartCheckout").append('<div>Chưa có sản phẩm trong giỏ hàng</div>');
    } else {
        $.each(cart.getList(), function (i, v) {
            var itemTr = $("<tr>").addClass("cart_item");
            itemTr.append(`
                    <td class="cart-product-name">${v.name} <strong class="product-quantity">× ${v.quantity}</strong>
                    </td>
                    <td class="cart-product-total text-center"><span class="amount">${v.price * v.quantity} VNĐ</span></td>
                `);
            $('#tblCartCheckout').append(itemTr);
        });
    }
    $('#totalC').html(`${cart.getTotal() + 10000} VNĐ`);

    //-------------------------------------------------------------------------------------

    $('#order').click(function () {
        var $formDataObject = {};
        $.each($('#form').serializeArray(), function (i, field) {
            $formDataObject[field.name] = field.value;
        });

        $.ajax({
            url: '/api/cart/Cart',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(cartList),
            success: function (response) {
                $formDataObject['id'] = response.id;
                $.ajax({
                    url: '/api/cart/updatecart',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify($formDataObject),
                    success: function (response) {
                        console.log(response);
                    },
                });

                localStorage.clear();
                helper.showNotf();
                setTimeout(function () {
                    window.location.href = '/';
                }, 2000);
            },
            error: function (error) {
                alert("Định hack đoạn này à :)), validate đoạn này rồi quêêêêêêêêêêêêêêêêêêêêêêêêêêêê");
            }
        });
    });

</script>
}